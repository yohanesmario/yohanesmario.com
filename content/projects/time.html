+++
title = "Time"
date = "2020-07-31"
author = "Yohanes Mario Chandra"
+++
<main class="main"></main>
<script>
    // get timezone from `tz` query param
    const urlParams = new URLSearchParams(window.location.search);
    const tz = urlParams.get('tz') || 'UTC';
    const rotate = urlParams.get('rotate') || '0';
    var offset = 0;
    var currentTimestampInMinutes = 0;

    // fetch timestamp from an ntp
    fetch('https://worldtimeapi.org/api/ip', { method: 'GET', mode: 'cors' })
        .then(response => response.json())
        .then(data => {
            // get the timestamp from the ntp server
            const timestamp = new Date(data.datetime).getTime();
            // get timestamp offset from local
            offset = timestamp - Date.now();
        })
        .catch(error => {
            console.error('Error fetching timestamp:', error);
        });
    
    // function to update the current time
    function updateTime() {
        // get current time based on the timezone
        const timestamp = Date.now() + offset;
        const timestampInMinutes = Math.floor(timestamp / 60000);
        if (currentTimestampInMinutes !== timestampInMinutes) {
            const now = new Date(timestamp);
            const currentTime = now.toLocaleTimeString('en-US', { timeZone: tz, hour: 'numeric', minute: 'numeric', hour12: false });
            const currentDate = now.toLocaleDateString('en-ID', { timeZone: tz, weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            // update the content of the element with the class `main` to display the current time
            document.querySelector('.main').innerHTML = `<div><div class='time'>${currentTime}</div><div class='date'>${currentDate}</div></div>`;
            currentTimestampInMinutes = timestampInMinutes;
        }
        // update the time every 1 second
        setTimeout(updateTime, 1000);
    }
    
    // when dom is loaded, update element with the class `main` to display the current time using digital clock format
    document.addEventListener('DOMContentLoaded', function() {
        document.body.style.transform = `rotate(${rotate}deg)`;
        updateTime();
    });

    // on click, rotate the entire page 90 degrees more
    document.addEventListener('click', function() {
        document.body.style.transform = `rotate(${(parseInt(document.body.style.transform.replace('rotate(', '').replace('deg)', '')) || 0) + 90}deg)`;
    });
</script>
<style>
    .main {
        display: flex;
        height: 100%;
        justify-content: center;
        align-items: center;
        text-align: center;
        font-family: Arial;
        flex-direction: column;
    }

    .time {
        font-size: 12em;
        font-weight: bold;
    }

    .date {
        font-size: 2em;
    }
</style>
